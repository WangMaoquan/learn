import{_ as t}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as p,c as d,d as e,w as a,a as k,b as i,e as s,o as r}from"./app-DMwitqrB.js";const B={},g=k('<h2 id="引入" tabindex="-1"><a class="header-anchor" href="#引入"><span>引入</span></a></h2><p><code>vue2.x</code> 的响应式 是通过 <code>Watcher</code>, <code>Observer</code>, <code>Dep</code> 来实现的 即 <code>观察者模式-发布订阅模式</code></p><p><code>Observer</code> 通过 <code>Object.defineProperty</code> 来劫持对象的 <code>key</code><code>Dep</code> 即依赖, 主要做两件事, <code>get</code> 时 收集依赖, <code>set</code> 时通知 <code>Watcher</code><code>Watcher</code> 接收到通知 调用自己的 <code>update</code> 去 触发 <code>render</code>(不一定都是<code>render</code>, 只是举个例子)</p><p>那么 <code>vue3.x</code> 呢?</p><ol><li><code>trigger</code>, <code>track</code> 实现了 <code>派发更新</code> 与 <code>收集依赖</code></li><li><code>targetMap</code> 实现了 依赖的对应关系</li><li><code>reactiveEffect</code> 就是实现了调用 <code>render</code> (举例)部分</li></ol><h2 id="简单实现" tabindex="-1"><a class="header-anchor" href="#简单实现"><span>简单实现</span></a></h2>',6),c=i("div",{class:"language-shell line-numbers-mode","data-highlighter":"shiki","data-ext":"shell","data-title":"shell",style:{"--shiki-light":"#24292e","--shiki-dark":"#abb2bf","--shiki-light-bg":"#fff","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes github-light one-dark-pro vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}},"pnpm"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," init")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}},"pnpm"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," i"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," rollup"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#D19A66"}}," -D")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}},"pnpm"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," i"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," rollup-typescript2"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," typescript"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#D19A66"}}," -D")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}},"npx"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," tsc"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#D19A66"}}," --init")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"})])],-1),y=i("div",{class:"language-typescript line-numbers-mode","data-highlighter":"shiki","data-ext":"typescript","data-title":"typescript",style:{"--shiki-light":"#24292e","--shiki-dark":"#abb2bf","--shiki-light-bg":"#fff","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes github-light one-dark-pro vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E5C07B"}},"console"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}},"log"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#D19A66"}},"123"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},");")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"})])],-1),E=i("div",{class:"language-typescript line-numbers-mode","data-highlighter":"shiki","data-ext":"typescript","data-title":"typescript",style:{"--shiki-light":"#24292e","--shiki-dark":"#abb2bf","--shiki-light-bg":"#fff","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes github-light one-dark-pro vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}},"import"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}}," typescript"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}}," from"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," 'rollup-plugin-typescript2'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},";")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}},"export"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}}," default"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"  input"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}},"'src/index.ts'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"  output"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},": {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"    file"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}},"'dist/bundle.js'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"    format"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}},"'cjs'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"  },")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"  plugins"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},": ["),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}},"typescript"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"()],")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"};")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"})])],-1),A=i("div",{class:"language-json line-numbers-mode","data-highlighter":"shiki","data-ext":"json","data-title":"json",style:{"--shiki-light":"#24292e","--shiki-dark":"#abb2bf","--shiki-light-bg":"#fff","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes github-light one-dark-pro vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"{")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#E06C75"}},'  "scripts"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},": {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#E06C75"}},'    "build"'),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},": "),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}},'"rollup --config"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"  }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"}")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"})])],-1),C=i("blockquote",null,[i("p",null,"有报错自己看报错信息")],-1),F=i("p",null,[s("执行 "),i("code",null,"pnpm run build"),s(" 看是否生成了 "),i("code",null,"dist/bundle.js")],-1),o=i("h3",{id:"proxy-基础代码-以及-reactive-简单实现",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#proxy-基础代码-以及-reactive-简单实现"},[i("span",null,"Proxy 基础代码, 以及 reactive 简单实现")])],-1),v=i("div",{class:"language-ts line-numbers-mode","data-highlighter":"shiki","data-ext":"ts","data-title":"ts",style:{"--shiki-light":"#24292e","--shiki-dark":"#abb2bf","--shiki-light-bg":"#fff","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes github-light one-dark-pro vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}},"import"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}}," { "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"track"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},", "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"trigger"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}}," } "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}},"from"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," './effect'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},";")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}},"function"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}}," get"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"("),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#E06C75","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"target"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#ABB2BF"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#E5C07B"}}," object"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},", "),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#E06C75","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"key"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#ABB2BF"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#E5C07B"}}," string"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#ABB2BF"}}," |"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#E5C07B"}}," symbol"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},", "),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#E06C75","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"receiver"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#ABB2BF"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#E5C07B"}}," object"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}},"  const"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#E5C07B"}}," res"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#56B6C2"}}," ="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E5C07B"}}," Reflect"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}},"get"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"target"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},", "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"key"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},", "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"receiver"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},");")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}},"  track"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"target"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},", "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"key"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},");")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}},"  return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}}," res"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}},"function"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}}," set"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"(")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#E06C75","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"  target"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#ABB2BF"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#E5C07B"}}," object"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#E06C75","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"  key"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#ABB2BF"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#E5C07B"}}," string"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#ABB2BF"}}," |"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#E5C07B"}}," symbol"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#E06C75","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"  value"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#ABB2BF"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#E5C07B"}}," unknown"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#E06C75","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"  receiver"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#ABB2BF"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#E5C07B"}}," object"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},")"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#ABB2BF"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#E5C07B"}}," boolean"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}},"  const"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#E5C07B"}}," result"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#56B6C2"}}," ="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E5C07B"}}," Reflect"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}},"set"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"target"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},", "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"key"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},", "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"value"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},", "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"receiver"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}},"  trigger"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"target"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},", "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"key"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}},"  return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}}," result"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"}")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}},"export"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}}," const"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#E5C07B"}}," mutableHandlers"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#ABB2BF"}},":"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#E5C07B"}}," ProxyHandler"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"<"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#E5C07B"}},"object"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"> "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#56B6C2"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}}," {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"  get"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"  set"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"};")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"})])],-1),D=i("div",{class:"language-typescript line-numbers-mode","data-highlighter":"shiki","data-ext":"typescript","data-title":"typescript",style:{"--shiki-light":"#24292e","--shiki-dark":"#abb2bf","--shiki-light-bg":"#fff","--shiki-dark-bg":"#282c34"}},[i("pre",{class:"shiki shiki-themes github-light one-dark-pro vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}},"import"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}}," { "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"mutableHandlers"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}}," } "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}},"from"),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," './baseHandlers'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},";")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}},"export"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}}," const"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#E5C07B"}}," reactiveMap"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#56B6C2"}}," ="),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}}," new"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}}," WeakMap"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"<"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#E5C07B"}},"object"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#E5C07B"}},"any"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},">();")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}},"export"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}}," function"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}}," reactive"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"<"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#E5C07B"}},"T"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}}," extends"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#E5C07B"}}," object"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},">("),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#E06C75","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"target"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#ABB2BF"}},":"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#E5C07B"}}," T"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},")"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#ABB2BF"}},":"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#E5C07B"}}," T"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}},"export"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}}," function"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}}," reactive"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"("),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#E06C75","--shiki-light-font-style":"inherit","--shiki-dark-font-style":"italic"}},"target"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#ABB2BF"}},":"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#E5C07B"}}," object"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}},"  if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}}," ("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"target"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#56B6C2"}}," !=="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#D19A66"}}," null"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#56B6C2"}}," &&"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}}," typeof"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}}," target"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#56B6C2"}}," !=="),i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#98C379"}}," 'object'"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}},"    return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}}," target"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"  }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}},"  const"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#E5C07B"}}," existingProxy"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#56B6C2"}}," ="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E5C07B"}}," reactiveMap"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}},"get"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"target"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}},"  if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}}," ("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"existingProxy"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},") {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}},"    return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}}," existingProxy"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"  }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}},"  const"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#E5C07B"}}," proxy"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#56B6C2"}}," ="),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}}," new"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}}," Proxy"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"target"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},", "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"mutableHandlers"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E5C07B"}},"  reactiveMap"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"."),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#61AFEF"}},"set"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"("),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"target"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},", "),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}},"proxy"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},");")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#C678DD"}},"  return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E06C75"}}," proxy"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#ABB2BF"}},"}")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"})])],-1),u=k(`<h3 id="reactiveeffect-实现" tabindex="-1"><a class="header-anchor" href="#reactiveeffect-实现"><span>reactiveEffect 实现</span></a></h3><ol><li>接收一个参数 <code>fn</code></li><li>需要有一个 <code>run</code> 方法 去执行 那个 <code>fn</code></li><li>还需要指明一个全局的 <code>activeReactiveEffect</code> 方便被收集</li></ol><div class="language-typescript line-numbers-mode" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> ReactiveEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> fn</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> T</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">      activeEffect</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      return</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">finally</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">      activeEffect</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="effect-实现" tabindex="-1"><a class="header-anchor" href="#effect-实现"><span>effect 实现</span></a></h3><ol><li><code>effect</code> 应该和 <code>reactiveEffect</code> 一样接收一个 <code>fn</code></li><li><code>effect</code> 需要立刻执行</li><li><code>effect</code> 需要返回一个 <code>runner</code></li></ol><div class="language-typescript line-numbers-mode" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> ReactiveEffectRunner</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  ()</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> T</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;">  effect</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> ReactiveEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> effect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fn</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> T</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> ReactiveEffectRunner</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ((</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fn</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> ReactiveEffectRunner</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">effect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    fn</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fn</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> ReactiveEffectRunner</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">effect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> _effect</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ReactiveEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  _effect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> runner</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> _effect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">bind</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">_effect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> ReactiveEffectRunner</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  runner</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">effect</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> _effect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> runner</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现-track" tabindex="-1"><a class="header-anchor" href="#实现-track"><span>实现 track</span></a></h3><ol><li>接收一个<code>对象</code> 和 触发的 <code>key</code></li><li>获取 <code>key</code> 对应 的 <code>dep</code> , 然后 将当前的 <code>activeEffect</code> 收集进去</li></ol><div class="language-typescript line-numbers-mode" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> track</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">target</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> object</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> unknown</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">activeEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> depsMap</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> targetMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">depsMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      targetMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">depsMap</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> dep</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> depsMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">dep</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      depsMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">dep</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Set</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    dep</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">activeEffect</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现-trigger" tabindex="-1"><a class="header-anchor" href="#实现-trigger"><span>实现 trigger</span></a></h3><ol><li>接收一个<code>对象</code> 和 触发的 <code>key</code></li><li>获取 <code>key</code> 对应 的 <code>dep</code> , 存进 <code>deps</code></li><li>遍历 deps, 并执行 <code>reactiveEffect</code> 的 <code>run</code> 方法</li></ol><div class="language-typescript line-numbers-mode" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> trigger</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">target</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> object</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> unknown</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> depsMap</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> targetMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">depsMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> deps</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">Dep</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)[] </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    deps</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">depsMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">deps</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">deps</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      triggerEffects</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">deps</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> effects</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> ReactiveEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> dep</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> deps</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">dep</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        effects</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">dep</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    triggerEffects</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Set</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">effects</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> triggerEffects</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">dep</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Dep</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> ReactiveEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[]) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> effects</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Array</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">dep</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> dep</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">dep</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> effect</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> effects</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">effect</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> activeEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      effect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><a href="https://github.com/WangMaoquan/mini-reactiveEffect" target="_blank" rel="noopener noreferrer">代码仓库</a></p></blockquote>`,13);function b(f,m){const n=p("CodeTabs");return r(),d("div",null,[g,e(n,{id:"32",data:[{id:"初始化项目"},{id:"src/index.ts"},{id:"rollup.config.mjs"},{id:"package.json"}]},{title0:a(({value:l,isActive:h})=>[s("初始化项目")]),title1:a(({value:l,isActive:h})=>[s("src/index.ts")]),title2:a(({value:l,isActive:h})=>[s("rollup.config.mjs")]),title3:a(({value:l,isActive:h})=>[s("package.json")]),tab0:a(({value:l,isActive:h})=>[c]),tab1:a(({value:l,isActive:h})=>[y]),tab2:a(({value:l,isActive:h})=>[E]),tab3:a(({value:l,isActive:h})=>[A]),_:1}),C,F,o,e(n,{id:"57",data:[{id:"src/baseHandlers.ts"},{id:"src/reactive.ts"}]},{title0:a(({value:l,isActive:h})=>[s("src/baseHandlers.ts")]),title1:a(({value:l,isActive:h})=>[s("src/reactive.ts")]),tab0:a(({value:l,isActive:h})=>[v]),tab1:a(({value:l,isActive:h})=>[D]),_:1}),u])}const j=t(B,[["render",b],["__file","reactiveEffect.html.vue"]]),R=JSON.parse('{"path":"/learn-vue/reactivity/reactiveEffect.html","title":"reactiveEffect","lang":"zh-CN","frontmatter":{"title":"reactiveEffect","date":"2023-03-12T09:37:54.000Z","tag":["vue"],"category":["vue"],"description":"vue3.x 响应式的另外一个核心 reactiveEffect","footer":true},"headers":[{"level":2,"title":"引入","slug":"引入","link":"#引入","children":[]},{"level":2,"title":"简单实现","slug":"简单实现","link":"#简单实现","children":[{"level":3,"title":"Proxy 基础代码, 以及 reactive 简单实现","slug":"proxy-基础代码-以及-reactive-简单实现","link":"#proxy-基础代码-以及-reactive-简单实现","children":[]},{"level":3,"title":"reactiveEffect 实现","slug":"reactiveeffect-实现","link":"#reactiveeffect-实现","children":[]},{"level":3,"title":"effect 实现","slug":"effect-实现","link":"#effect-实现","children":[]},{"level":3,"title":"实现 track","slug":"实现-track","link":"#实现-track","children":[]},{"level":3,"title":"实现 trigger","slug":"实现-trigger","link":"#实现-trigger","children":[]}]}],"git":{"createdTime":1678599756000,"updatedTime":1678599756000,"contributors":[{"name":"wangmaoquan","email":"1782976211@qq.com","commits":1}]},"readingTime":{"minutes":2.32,"words":696},"filePathRelative":"learn-vue/reactivity/reactiveEffect.md","localizedDate":"2023年3月12日","excerpt":"<h2>引入</h2>\\n<p><code>vue2.x</code> 的响应式 是通过 <code>Watcher</code>, <code>Observer</code>, <code>Dep</code> 来实现的 即 <code>观察者模式-发布订阅模式</code></p>\\n<p><code>Observer</code> 通过 <code>Object.defineProperty</code> 来劫持对象的 <code>key</code>\\n<code>Dep</code> 即依赖, 主要做两件事, <code>get</code> 时 收集依赖, <code>set</code> 时通知 <code>Watcher</code>\\n<code>Watcher</code> 接收到通知 调用自己的 <code>update</code> 去 触发 <code>render</code>(不一定都是<code>render</code>, 只是举个例子)</p>"}');export{j as comp,R as data};

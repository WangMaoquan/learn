---
title: æ¯”è¾ƒ
date: 2023-01-02
tag:
  - learn
  - vue
category:
  - vue
description: 'learn'
footer: true
---

### åº”ç”¨é…ç½®é¡¹

config æ˜¯ä¸€ä¸ªåŒ…å« Vue åº”ç”¨ç¨‹åºå…¨å±€é…ç½®çš„å¯¹è±¡ã€‚å¯ä»¥åœ¨æŒ‚è½½åº”ç”¨ç¨‹åºä¹‹å‰ä¿®æ”¹ä¸‹é¢åˆ—å‡ºçš„å±æ€§ã€‚

- **devtools** **ç±»å‹ï¼š** boolean **é»˜è®¤å€¼ï¼š** true **å¦‚ä½•ä½¿ç”¨ï¼š**

```javascript
app.config.devtools = true;
// æ˜¯å¦å¼€å¯ vue-devtools å·¥å…·çš„æ£€æµ‹ï¼Œé»˜è®¤æƒ…å†µä¸‹å¼€å‘ç¯å¢ƒæ˜¯ trueï¼Œç”Ÿäº§ç¯å¢ƒä¸‹åˆ™ä¸º falseã€‚
```

- **errorHandler** **ç±»å‹ï¼š** Function **é»˜è®¤å€¼ï¼š** undefined **å¦‚ä½•ä½¿ç”¨ï¼š**

```javascript
app.config.errorHandler = (err, vm, info) => {
  // info ä¸º Vue åœ¨æŸä¸ªç”Ÿå‘½å‘¨æœŸå‘ç”Ÿé”™è¯¯çš„ä¿¡æ¯
};
// ä¸ºç»„ä»¶æ¸²æŸ“åŠŸèƒ½å’Œè§‚å¯Ÿç¨‹åºæœŸé—´çš„æœªæ•è·é”™è¯¯åˆ†é…å¤„ç†ç¨‹åºã€‚
```

- **globalProperties** ğŸŒŸ **ç±»å‹ï¼š** [key: string]: any **é»˜è®¤å€¼ï¼š** undefined **å¦‚ä½•ä½¿ç”¨ï¼š**

```javascript
app.config.globalProperties.userName = 'decade';

app.component('c-component', {
  mounted() {
    console.log(this.userName); // 'decade'
  },
  // è‹¥æ˜¯ç»„ä»¶å†…ä¹Ÿæœ‰ name å±æ€§ï¼Œåˆ™ç»„å»ºå†…çš„å±æ€§æƒé™æ¯”è¾ƒé«˜ã€‚
});
```

è¿˜æœ‰ä¸€ä¸ªçŸ¥è¯†ç‚¹å¾ˆé‡è¦ï¼Œåœ¨ Vue2.x ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå…¨å±€å±æ€§æˆ–è€…æ–¹æ³•éƒ½æ˜¯å¦‚ä¸‹æ‰€ç¤ºï¼š

```javascript
Vue.prototype.$md5 = () => {};
```

åœ¨ Vue3.0 ä¸­ï¼Œæˆ‘ä»¬ä¾¿å¯è¿™æ ·å®šä¹‰ï¼š

```javascript
const app = Vue.createApp({});
app.config.globalProperties.$md5 = () => {};
```

- **performance** **ç±»å‹ï¼š** boolean **é»˜è®¤å€¼ï¼š** false **å¦‚ä½•ä½¿ç”¨ï¼š**

```javascript
app.config.performance = true;
// å°†å…¶è®¾ç½®ä¸º true å¯åœ¨æµè§ˆå™¨ devtool æ€§èƒ½/æ—¶é—´çº¿é¢æ¿ä¸­å¯ç”¨ç»„ä»¶åˆå§‹åŒ–ï¼Œç¼–è¯‘ï¼Œæ¸²æŸ“å’Œè¡¥ä¸æ€§èƒ½è·Ÿè¸ªã€‚ ä»…åœ¨å¼€å‘æ¨¡å¼å’Œæ”¯æŒ Performance.mark APIçš„æµè§ˆå™¨ä¸­å·¥ä½œã€‚
```

#### Application API

å…¨å±€æ”¹å˜çš„åŠ¨ä½œï¼Œéƒ½åœ¨ createApp æ‰€åˆ›å»ºçš„åº”ç”¨å®ä¾‹ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```javascript
import { createApp } from 'vue';
const app = createApp({});
```

é‚£ä¹ˆ app ä¸‹è¿™äº›å±æ€§ï¼š

- **component** **å‚æ•°ï¼š** ç¬¬ä¸€ä¸ªå‚æ•° string ç±»å‹è¡¨ç¤ºç»„ä»¶åï¼Œç¬¬äºŒä¸ªå‚æ•° Function æˆ– Object **è¿”å›å€¼ï¼š** åªä¼ ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¿”å›ç»„å»ºã€‚å¸¦ä¸Šç¬¬äºŒä¸ªå‚æ•°åˆ™è¿”å›åº”ç”¨ç¨‹åºå®ä¾‹ **å¦‚ä½•ä½¿ç”¨ï¼š**

```javascript
import { createApp } from 'vue';
const app = createApp({});
// æ³¨å†Œä¸€ä¸ª options å¯¹è±¡
app.component('shisan-component', {
  /* ... */
});

// æ£€ç´¢æ³¨å†Œçš„ç»„ä»¶
const DecadeComponent = app.component('decade-component');
```

- **config**(ä¸Šé¢ç¬¬ä¸€æ®µè®²è¿‡äº†)
- **directive** è‡ªå®šä¹‰æŒ‡ä»¤å˜åŒ–ä¸å¤§ï¼Œè¿˜æ˜¯ä¹‹å‰é‚£äº›ä¸œè¥¿ï¼Œå¦‚ä¸‹ï¼š

```javascript
app.directive('my-directive', {
  // æŒ‚è½½å‰
  beforeMount() {},
  // æŒ‚è½½å
  mounted() {},
  // æ›´æ–°å‰
  beforeUpdate() {},
  // æ›´æ–°å
  updated() {},
  // å¸è½½å‰
  beforeUnmount() {},
  // å¸è½½å
  unmounted() {},
});
```

### composition api

composition api ä¸º vue åº”ç”¨æä¾›æ›´å¥½çš„é€»è¾‘å¤ç”¨å’Œä»£ç ç»„ç»‡ã€‚

```vue
<template>
  <div>
    <p>counter: {{ counter }}</p>
    <p>doubleCounter: {{ doubleCounter }}</p>
    <p ref="desc"></p>
  </div>
</template>

<script>
  import {
    reactive,
    computed,
    watch,
    ref,
    toRefs,
    onMounted,
    onUnmounted,
  } from 'vue';

  export default {
    setup() {
      const data = reactive({
        counter: 1,
        doubleCounter: computed(() => data.counter * 2),
      });

      let timer;

      onMounted(() => {
        timer = setInterval(() => {
          data.counter++;
        }, 1000);
      });

      onUnmounted(() => {
        clearInterval(timer);
      });

      const desc = ref(null);

      watch(
        () => data.counter,
        (val, oldVal) => {
          // console.log(`counter change from ${oldVal} to ${val}`);
          desc.value.textContent = `counter change from ${oldVal} to ${val}`;
        },
      );

      return { ...toRefs(data), desc };
    },
  };
</script>
```

### Teleport

ä¼ é€é—¨ç»„ä»¶æä¾›ä¸€ç§ç®€æ´çš„æ–¹å¼å¯ä»¥æŒ‡å®šå®ƒé‡Œé¢å†…å®¹çš„çˆ¶å…ƒç´ ã€‚

```vue
<template>
  <button @click="modalOpen = true">å¼¹å‡ºä¸€ä¸ªå…¨å±æ¨¡æ€çª—å£</button>

  <teleport to="body">
    <div v-if="modalOpen" class="modal">
      <div>
        è¿™æ˜¯ä¸€ä¸ªæ¨¡æ€çª—å£! æˆ‘çš„çˆ¶å…ƒç´ æ˜¯"body"ï¼
        <button @click="modalOpen = false">Close</button>
      </div>
    </div>
  </teleport>
</template>

<script>
  export default {
    data() {
      return {
        modalOpen: true,
      };
    },
  };
</script>

<style scoped>
  .modal {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .modal div {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background-color: white;
    width: 300px;
    height: 300px;
    padding: 5px;
  }
</style>
```

### Fragments

vue3 ä¸­ç»„ä»¶å¯ä»¥æ‹¥æœ‰å¤šä¸ªæ ¹ã€‚

```vue
<template>
  <header>...</header>
  <main v-bind="$attrs">...</main>
  <footer>...</footer>
</template>
```

### Emits Component Option

vue3 ä¸­ç»„ä»¶å‘é€çš„è‡ªå®šä¹‰äº‹ä»¶éœ€è¦å®šä¹‰åœ¨ emits é€‰é¡¹ä¸­ï¼š

- åŸç”Ÿäº‹ä»¶ä¼šè§¦å‘ä¸¤æ¬¡ï¼Œæ¯”å¦‚`click`
- æ›´å¥½çš„æŒ‡ç¤ºç»„ä»¶å·¥ä½œæ–¹å¼
- å¯¹è±¡å½¢å¼äº‹ä»¶æ ¡éªŒ

```vue
<template>
  <div @click="$emit('click')">
    <h3>è‡ªå®šä¹‰äº‹ä»¶</h3>
  </div>
</template>

<script>
  export default {
    emits: ['click'],
  };
</script>
```

### è‡ªå®šä¹‰æ¸²æŸ“å™¨ custom renderer

Vue3.0 ä¸­æ”¯æŒ _è‡ªå®šä¹‰æ¸²æŸ“å™¨_ (Renderer)ï¼šè¿™ä¸ª API å¯ä»¥ç”¨æ¥è‡ªå®šä¹‰æ¸²æŸ“é€»è¾‘ã€‚æ¯”å¦‚ä¸‹é¢çš„æ¡ˆä¾‹æˆ‘ä»¬å¯ä»¥æŠŠæ•°æ®æ¸²æŸ“åˆ° canvas ä¸Šã€‚

- é¦–å…ˆåˆ›å»ºä¸€ä¸ªç»„ä»¶æè¿°è¦æ¸²æŸ“çš„æ•°æ®ï¼Œæˆ‘ä»¬æƒ³è¦æ¸²æŸ“ä¸€ä¸ªå«åš piechart çš„ç»„ä»¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦å•ç‹¬å£°æ˜è¯¥ç»„ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬åªæ˜¯æƒ³æŠŠå®ƒæºå¸¦çš„æ•°æ®ç»˜åˆ¶åˆ° canvas ä¸Šã€‚åˆ›å»º CanvasApp.vue

  ```vue
  <template>
    <piechart
      @click="handleClick"
      :data="state.data"
      :x="200"
      :y="200"
      :r="200"
    ></piechart>
  </template>
  <script>
    import { reactive, ref } from 'vue';
    export default {
      setup() {
        const state = reactive({
          data: [
            { name: 'å¤§ä¸“', count: 200, color: 'brown' },
            { name: 'æœ¬ç§‘', count: 300, color: 'yellow' },
            { name: 'ç¡•å£«', count: 100, color: 'pink' },
            { name: 'åšå£«', count: 50, color: 'skyblue' },
          ],
        });
        function handleClick() {
          state.data.push({ name: 'å…¶ä»–', count: 30, color: 'orange' });
        }
        return {
          state,
          handleClick,
        };
      },
    };
  </script>
  ```

- ä¸‹é¢æˆ‘ä»¬åˆ›å»ºè‡ªå®šä¹‰æ¸²æŸ“å™¨ï¼Œmain.js

  ```javascript
  import { createApp, createRenderer } from 'vue'
  import CanvasApp from './CanvasApp.vue'

  const nodeOps = {
   insert: (child, parent, anchor) => {
     // æˆ‘ä»¬é‡å†™äº†inserté€»è¾‘ï¼Œå› ä¸ºåœ¨æˆ‘ä»¬canvasAppä¸­ä¸å­˜åœ¨å®é™…domæ’å…¥æ“ä½œ
     // è¿™é‡Œé¢åªéœ€è¦å°†å…ƒç´ ä¹‹é—´çš„çˆ¶å­å…³ç³»ä¿å­˜ä¸€ä¸‹å³å¯
     child.parent = parent;

     if (!parent.childs) {
       parent.childs = [child]
    } else {
       parent.childs.push(child);
    }

     // åªæœ‰canvasæœ‰nodeTypeï¼Œè¿™é‡Œå°±æ˜¯å¼€å§‹ç»˜åˆ¶å†…å®¹åˆ°canvas
     if (parent.nodeType == 1) {
       draw(child);
       // å¦‚æœå­å…ƒç´ ä¸Šé™„åŠ äº†äº‹ä»¶ï¼Œæˆ‘ä»¬ç»™canvasæ·»åŠ ç›‘å¬å™¨
       if (child.onClick) {
         ctx.canvas.addEventListener('click', () => {
           child.onClick();
           setTimeout(() => {
             draw(child)
          }, 0);
        })
      }
    }
  },
   remove: child => {},
   createElement: (tag, isSVG, is) => {
     // åˆ›å»ºå…ƒç´ æ—¶ç”±äºæ²¡æœ‰éœ€è¦åˆ›å»ºçš„domå…ƒç´ ï¼Œåªéœ€è¿”å›å½“å‰å…ƒç´ æ•°æ®å¯¹è±¡
     return {tag}
  },
   createText: text => {},
   createComment: text => {},
   setText: (node, text) => {},
   setElementText: (el, text) => {},
   parentNode: node => {},
   nextSibling: node => {},
   querySelector: selector => {},
   setScopeId(el, id) {},
   cloneNode(el) {},
   insertStaticContent(content, parent, anchor, isSVG) {},
   patchProp(el, key, prevValue, nextValue) {
     el[key] = nextValue;
  },
  };

  // åˆ›å»ºä¸€ä¸ªæ¸²æŸ“å™¨
  let renderer = createRenderer(nodeOps);

  // ä¿å­˜ç”»å¸ƒå’Œå…¶ä¸Šä¸‹æ–‡
  let ctx;
  let canvas;

  // æ‰©å±•mountï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªç”»å¸ƒå…ƒç´ 
  function createCanvasApp(App) {
   const app = renderer.createApp(App);
   const mount = app.mount
   app.mount = mount(selector) {
     canvas = document.createElement('canvas');
     canvas.width = window.innerWidth;
     canvas.height = window.innerHeight;
     document.querySelector(selector).appendChild(canvas);
     ctx = canvas.getContext('2d');
     mount(canvas);
  }
   return app
  }

  createCanvasApp(CanvasApp).mount('#demo')
  ```

- ç¼–å†™ç»˜åˆ¶é€»è¾‘

  ```javascript
  const draw = (el, noClear) => {
    if (!noClear) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }
    if (el.tag == 'piechart') {
      let { data, r, x, y } = el;
      let total = data.reduce((memo, current) => memo + current.count, 0);
      let start = 0,
        end = 0;
      data.forEach((item) => {
        end += (item.count / total) * 360;
        drawPieChart(start, end, item.color, x, y, r);
        drawPieChartText(item.name, (start + end) / 2, x, y, r);
        start = end;
      });
    }
    el.childs && el.childs.forEach((child) => draw(child, true));
  };

  const d2a = (n) => {
    return (n * Math.PI) / 180;
  };
  const drawPieChart = (start, end, color, cx, cy, r) => {
    let x = cx + Math.cos(d2a(start)) * r;
    let y = cy + Math.sin(d2a(start)) * r;
    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.lineTo(x, y);
    ctx.arc(cx, cy, r, d2a(start), d2a(end), false);
    ctx.fillStyle = color;
    ctx.fill();
    ctx.stroke();
    ctx.closePath();
  };
  const drawPieChartText = (val, position, cx, cy, r) => {
    ctx.beginPath();
    let x = cx + (Math.cos(d2a(position)) * r) / 1.25 - 20;
    let y = cy + (Math.sin(d2a(position)) * r) / 1.25;
    ctx.fillStyle = '#000';
    ctx.font = '20px å¾®è½¯é›…é»‘';
    ctx.fillText(val, x, y);
    ctx.closePath();
  };
  ```

### reactive

```javascript
import { reactive, computed } from 'vue';

export default {
  setup() {
    const state = reactive({
      a: 0,
    });

    function increment() {
      state.a++;
    }

    return {
      state,
      increment,
    };
  },
};
// reactive ç›¸å½“äº Vue2.x çš„ Vue.observable () APIï¼Œç»è¿‡ reactive å¤„ç†åçš„å‡½æ•°èƒ½å˜æˆå“åº”å¼çš„æ•°æ®ï¼Œç±»ä¼¼ä¹‹å‰å†™æ¨¡æ¿é¡µé¢æ—¶å®šä¹‰çš„ data å±æ€§çš„å€¼ã€‚
```

### watchEffect

```javascript
import { reactive, computed, watchEffect } from 'vue';

export default {
  setup() {
    const state = reactive({ a: 0 });

    const double = computed(() => state.a * 3);

    function increment() {
      state.count++;
    }

    const wa = watchEffect(() => {
      // ä½¿ç”¨åˆ°äº†å“ªä¸ª ref/reactive å¯¹è±¡.value, å°±ç›‘å¬å“ªä¸ª
      console.log(double.value);
    });
    // å¯ä»¥é€šè¿‡ wa.stop åœæ­¢ç›‘å¬
    return {
      state,
      increment,
    };
  },
};
// watchEffect è¢«ç§°ä¹‹ä¸ºå‰¯ä½œç”¨ï¼Œç«‹å³æ‰§è¡Œä¼ å…¥çš„ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶å“åº”å¼è¿½è¸ªå…¶ä¾èµ–ï¼Œå¹¶åœ¨å…¶ä¾èµ–å˜æ›´æ—¶é‡æ–°è¿è¡Œè¯¥å‡½æ•°ã€‚
```

### computed

```javascript
import { reactive, computed } from 'vue';

export default {
  setup() {
    const state = reactive({
      a: 0,
    });

    const double = computed(() => state.a * 3);

    function increment() {
      state.a++;
    }

    return {
      double,
      state,
      increment,
    };
  },
};
```

### ref å’Œ toRefs

toRefs æä¾›äº†ä¸€ä¸ªæ–¹æ³•å¯ä»¥æŠŠ reactive çš„å€¼å¤„ç†ä¸º refï¼Œä¹Ÿå°±æ˜¯å°†å“åº”å¼çš„å¯¹è±¡å¤„ç†ä¸ºæ™®é€šå¯¹è±¡ã€‚

### hooks

ä¸ 2.x ç‰ˆæœ¬ç›¸å¯¹åº”çš„ç”Ÿå‘½å‘¨æœŸé’©å­

| Vue2.x çš„ç”Ÿå‘½å‘¨æœŸ | Vue3.x çš„ç”Ÿå‘½å‘¨æœŸ |
| ----------------- | ----------------- |
| beforeCreate      | setup()           |
| created           | setup()           |
| beforeMount       | onBeforeMount     |
| mounted           | onMounted         |
| beforeUpdate      | onBeforeUpdate    |
| updated           | onUpdated         |
| beforeDestroy     | onBeforeUnmount   |
| destroyed         | onUnmounted       |
| errorCaptured     | onErrorCaptured   |

Vue3.0 åœ¨ Composition API ä¸­å¦å¤–åŠ äº†ä¸¤ä¸ªé’©å­ï¼Œåˆ†åˆ«æ˜¯ `onRenderTracked` å’Œ `onRenderTriggered`ï¼Œä¸¤ä¸ªé’©å­å‡½æ•°éƒ½æ¥æ”¶ä¸€ä¸ª `DebuggerEvent` :

```javascript
export default {
  onRenderTriggered(e) {
    debugger;
    // æ£€æŸ¥å“ªä¸ªä¾èµ–æ€§å¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“
  },
};
```
